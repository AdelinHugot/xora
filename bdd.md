-- WARNING: This schema is for context only and is not meant to be run.
-- Table order and constraints may not be valid for execution.

CREATE TABLE public.articles (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  titre character varying NOT NULL,
  slug character varying UNIQUE,
  contenu text,
  categorie character varying,
  tags character varying,
  id_auteur uuid,
  est_publie boolean DEFAULT false,
  nombre_vues integer DEFAULT 0,
  cree_le timestamp without time zone DEFAULT now(),
  modifie_le timestamp without time zone DEFAULT now(),
  publie_le timestamp without time zone,
  CONSTRAINT articles_pkey PRIMARY KEY (id),
  CONSTRAINT articles_id_auteur_fkey FOREIGN KEY (id_auteur) REFERENCES public.utilisateurs(id)
);
CREATE TABLE public.biens_immobiliers (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  id_contact uuid NOT NULL,
  adresse character varying NOT NULL,
  complement_adresse character varying,
  type character varying NOT NULL,
  proprietaire character varying NOT NULL,
  type_immobilier character varying,
  nature_bien character varying,
  type_travaux character varying,
  acqu_plus_deux_ans boolean DEFAULT false,
  etage character varying,
  ascenseur boolean DEFAULT false,
  infos_divers text,
  cree_le timestamp without time zone DEFAULT now(),
  modifie_le timestamp without time zone DEFAULT now(),
  CONSTRAINT biens_immobiliers_pkey PRIMARY KEY (id),
  CONSTRAINT biens_immobiliers_id_contact_fkey FOREIGN KEY (id_contact) REFERENCES public.contacts(id)
);
CREATE TABLE public.collaborateurs_rendez_vous (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  id_rendez_vous uuid NOT NULL,
  id_utilisateur uuid NOT NULL,
  statut_reponse character varying DEFAULT 'pas_repondu'::character varying,
  cree_le timestamp without time zone DEFAULT now(),
  CONSTRAINT collaborateurs_rendez_vous_pkey PRIMARY KEY (id),
  CONSTRAINT collaborateurs_rendez_vous_id_rendez_vous_fkey FOREIGN KEY (id_rendez_vous) REFERENCES public.rendez_vous(id),
  CONSTRAINT collaborateurs_rendez_vous_id_utilisateur_fkey FOREIGN KEY (id_utilisateur) REFERENCES public.utilisateurs(id)
);
CREATE TABLE public.contacts (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  civilite character varying NOT NULL,
  prenom character varying NOT NULL,
  nom character varying NOT NULL,
  email character varying,
  telephone character varying,
  telephone_mobile character varying,
  telephone_fixe character varying,
  nom_entreprise character varying,
  statut character varying NOT NULL,
  origine character varying,
  sous_origine character varying,
  nom_origine character varying,
  localisation character varying,
  adresse character varying,
  complement_adresse character varying,
  latitude numeric,
  longitude numeric,
  id_referent uuid,
  numero_compte_client character varying,
  id_ajoute_par uuid,
  date_ajout timestamp without time zone,
  cree_le timestamp without time zone DEFAULT now(),
  modifie_le timestamp without time zone DEFAULT now(),
  supprime_le timestamp without time zone,
  id_organisation uuid,
  agenceur_referent uuid,
  rgpd boolean DEFAULT false,
  societe text,
  CONSTRAINT contacts_pkey PRIMARY KEY (id),
  CONSTRAINT contacts_id_referent_fkey FOREIGN KEY (id_referent) REFERENCES public.utilisateurs(id),
  CONSTRAINT contacts_id_ajoute_par_fkey FOREIGN KEY (id_ajoute_par) REFERENCES public.utilisateurs(id),
  CONSTRAINT contacts_id_organisation_fkey FOREIGN KEY (id_organisation) REFERENCES public.organisations(id),
  CONSTRAINT contacts_agenceur_referent_fkey FOREIGN KEY (agenceur_referent) REFERENCES public.utilisateurs(id)
);
CREATE TABLE public.contacts_externes (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  id_contact uuid NOT NULL,
  civilite character varying,
  prenom character varying NOT NULL,
  nom character varying NOT NULL,
  email character varying,
  telephone character varying,
  relation character varying,
  cree_le timestamp without time zone DEFAULT now(),
  modifie_le timestamp without time zone DEFAULT now(),
  CONSTRAINT contacts_externes_pkey PRIMARY KEY (id),
  CONSTRAINT contacts_externes_id_contact_fkey FOREIGN KEY (id_contact) REFERENCES public.contacts(id)
);
CREATE TABLE public.documents_organisation (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  id_organisation uuid NOT NULL,
  nom character varying NOT NULL,
  type character varying NOT NULL,
  description text,
  url_fichier text,
  nom_fichier character varying,
  taille_fichier integer,
  type_mime character varying,
  cree_le timestamp without time zone DEFAULT now(),
  modifie_le timestamp without time zone DEFAULT now(),
  CONSTRAINT documents_organisation_pkey PRIMARY KEY (id),
  CONSTRAINT documents_organisation_id_organisation_fkey FOREIGN KEY (id_organisation) REFERENCES public.organisations(id)
);
CREATE TABLE public.etapes_projets (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  id_projet uuid NOT NULL,
  numero_etape integer NOT NULL,
  label character varying NOT NULL,
  progression integer DEFAULT 0,
  couleur character varying,
  cree_le timestamp without time zone DEFAULT now(),
  CONSTRAINT etapes_projets_pkey PRIMARY KEY (id),
  CONSTRAINT etapes_projets_id_projet_fkey FOREIGN KEY (id_projet) REFERENCES public.projets(id)
);
CREATE TABLE public.flux_activite (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  id_utilisateur uuid NOT NULL,
  type_activite character varying NOT NULL,
  type_entite character varying,
  id_entite character varying,
  description text,
  icone character varying,
  couleur character varying,
  cree_le timestamp without time zone DEFAULT now(),
  CONSTRAINT flux_activite_pkey PRIMARY KEY (id),
  CONSTRAINT flux_activite_id_utilisateur_fkey FOREIGN KEY (id_utilisateur) REFERENCES public.utilisateurs(id)
);
CREATE TABLE public.integrations (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  nom character varying NOT NULL,
  type_service character varying NOT NULL,
  cle_api character varying,
  config jsonb,
  est_actif boolean DEFAULT true,
  derniere_synchro timestamp without time zone,
  cree_le timestamp without time zone DEFAULT now(),
  modifie_le timestamp without time zone DEFAULT now(),
  CONSTRAINT integrations_pkey PRIMARY KEY (id)
);
CREATE TABLE public.kpis (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  type_kpi character varying NOT NULL,
  label character varying NOT NULL,
  valeur numeric,
  objectif numeric,
  unite character varying,
  couleur character varying,
  periode character varying,
  regle_calcul character varying,
  modifie_le timestamp without time zone DEFAULT now(),
  CONSTRAINT kpis_pkey PRIMARY KEY (id)
);
CREATE TABLE public.logs_audit (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  type_entite character varying NOT NULL,
  id_entite character varying NOT NULL,
  action character varying NOT NULL,
  id_utilisateur uuid,
  anciennes_valeurs jsonb,
  nouvelles_valeurs jsonb,
  adresse_ip character varying,
  user_agent text,
  cree_le timestamp without time zone DEFAULT now(),
  CONSTRAINT logs_audit_pkey PRIMARY KEY (id),
  CONSTRAINT logs_audit_id_utilisateur_fkey FOREIGN KEY (id_utilisateur) REFERENCES public.utilisateurs(id)
);
CREATE TABLE public.organisations (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  nom character varying NOT NULL,
  slug character varying NOT NULL UNIQUE,
  description text,
  logo_url text,
  adresse character varying,
  telephone character varying,
  email character varying,
  site_web character varying,
  statut character varying DEFAULT 'actif'::character varying,
  date_creation date DEFAULT CURRENT_DATE,
  cree_le timestamp without time zone DEFAULT now(),
  modifie_le timestamp without time zone DEFAULT now(),
  siret character varying,
  numero_tva character varying,
  CONSTRAINT organisations_pkey PRIMARY KEY (id)
);
CREATE TABLE public.projets (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  type character varying NOT NULL,
  id_contact uuid NOT NULL,
  nom_contact character varying,
  nom_projet character varying NOT NULL,
  titre character varying NOT NULL,
  statut character varying NOT NULL,
  progression integer DEFAULT 0,
  label_progression character varying,
  id_referent uuid,
  agence character varying,
  origine character varying,
  sous_origine character varying,
  lien_sponsor character varying,
  adresse_chantier character varying,
  adresse_facturation character varying,
  metier_etudie character varying,
  execution_travaux character varying,
  artisans_necessaires boolean DEFAULT false,
  liste_artisans text,
  date_signature date,
  dates_travaux character varying,
  date_installation date,
  budget_bas numeric,
  budget_haut numeric,
  budget_global numeric,
  financement character varying,
  enlevement character varying,
  installation character varying,
  livre_par character varying,
  plans_techniques boolean DEFAULT false,
  nombre_concurrents integer,
  concurrents text,
  budget_concurrence character varying,
  statut_projet character varying,
  permis_construire boolean DEFAULT false,
  date_permis date,
  telephone character varying,
  email character varying,
  types_ambiance text,
  ambiance_appreciee text,
  ambiance_eviter text,
  meubles text,
  poignees character varying,
  plan_travail character varying,
  sol_cuisine character varying,
  revetement_murs character varying,
  autres_details text,
  selection_meubles text,
  description_materiaux text,
  notes_ambiance text,
  notes_meubles text,
  notes_electromenagers text,
  notes_financier text,
  cree_le timestamp without time zone DEFAULT now(),
  modifie_le timestamp without time zone DEFAULT now(),
  supprime_le timestamp without time zone,
  id_organisation uuid,
  CONSTRAINT projets_pkey PRIMARY KEY (id),
  CONSTRAINT projets_id_contact_fkey FOREIGN KEY (id_contact) REFERENCES public.contacts(id),
  CONSTRAINT projets_id_referent_fkey FOREIGN KEY (id_referent) REFERENCES public.utilisateurs(id),
  CONSTRAINT projets_id_organisation_fkey FOREIGN KEY (id_organisation) REFERENCES public.organisations(id)
);
CREATE TABLE public.rendez_vous (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  titre character varying NOT NULL,
  id_contact uuid,
  date_debut date NOT NULL,
  heure_debut time without time zone NOT NULL,
  date_fin date NOT NULL,
  heure_fin time without time zone NOT NULL,
  lieu character varying,
  commentaires text,
  id_cree_par uuid,
  cree_le timestamp without time zone DEFAULT now(),
  modifie_le timestamp without time zone DEFAULT now(),
  supprime_le timestamp without time zone,
  id_organisation uuid,
  CONSTRAINT rendez_vous_pkey PRIMARY KEY (id),
  CONSTRAINT rendez_vous_id_contact_fkey FOREIGN KEY (id_contact) REFERENCES public.contacts(id),
  CONSTRAINT rendez_vous_id_cree_par_fkey FOREIGN KEY (id_cree_par) REFERENCES public.utilisateurs(id),
  CONSTRAINT rendez_vous_id_organisation_fkey FOREIGN KEY (id_organisation) REFERENCES public.organisations(id)
);
CREATE TABLE public.roles (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  nom character varying NOT NULL UNIQUE,
  description text,
  couleur character varying DEFAULT 'blue'::character varying,
  cree_le timestamp without time zone DEFAULT now(),
  modifie_le timestamp without time zone DEFAULT now(),
  CONSTRAINT roles_pkey PRIMARY KEY (id)
);
CREATE TABLE public.spatial_ref_sys (
  srid integer NOT NULL CHECK (srid > 0 AND srid <= 998999),
  auth_name character varying,
  auth_srid integer,
  srtext character varying,
  proj4text character varying,
  CONSTRAINT spatial_ref_sys_pkey PRIMARY KEY (srid)
);
CREATE TABLE public.taches (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  index_tache integer NOT NULL,
  type character varying NOT NULL,
  titre character varying NOT NULL,
  tag character varying NOT NULL,
  id_projet uuid,
  id_contact uuid,
  nom_client character varying,
  nom_projet character varying,
  id_affecte_a uuid,
  statut character varying NOT NULL,
  progression integer DEFAULT 0,
  date_echeance date,
  note text,
  est_en_retard boolean DEFAULT false,
  jours_retard integer DEFAULT 0,
  a_alerte boolean DEFAULT false,
  cree_le timestamp without time zone DEFAULT now(),
  modifie_le timestamp without time zone DEFAULT now(),
  supprime_le timestamp without time zone,
  id_organisation uuid,
  CONSTRAINT taches_pkey PRIMARY KEY (id),
  CONSTRAINT taches_id_projet_fkey FOREIGN KEY (id_projet) REFERENCES public.projets(id),
  CONSTRAINT taches_id_contact_fkey FOREIGN KEY (id_contact) REFERENCES public.contacts(id),
  CONSTRAINT taches_id_affecte_a_fkey FOREIGN KEY (id_affecte_a) REFERENCES public.utilisateurs(id),
  CONSTRAINT taches_id_organisation_fkey FOREIGN KEY (id_organisation) REFERENCES public.organisations(id)
);
CREATE TABLE public.utilisateurs (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  civilite character varying NOT NULL,
  prenom character varying NOT NULL,
  nom character varying NOT NULL,
  email character varying NOT NULL UNIQUE,
  telephone character varying,
  url_avatar text,
  id_role uuid NOT NULL,
  statut character varying DEFAULT 'actif'::character varying,
  date_adhesion timestamp without time zone DEFAULT now(),
  derniere_connexion timestamp without time zone,
  cree_le timestamp without time zone DEFAULT now(),
  modifie_le timestamp without time zone DEFAULT now(),
  id_organisation uuid,
  telephone_mobile character varying,
  CONSTRAINT utilisateurs_pkey PRIMARY KEY (id),
  CONSTRAINT utilisateurs_id_role_fkey FOREIGN KEY (id_role) REFERENCES public.roles(id),
  CONSTRAINT utilisateurs_id_organisation_fkey FOREIGN KEY (id_organisation) REFERENCES public.organisations(id)
);
CREATE TABLE public.utilisateurs_auth (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  id_auth_user uuid NOT NULL UNIQUE,
  id_utilisateur uuid NOT NULL UNIQUE,
  id_organisation uuid NOT NULL,
  cree_le timestamp without time zone DEFAULT now(),
  CONSTRAINT utilisateurs_auth_pkey PRIMARY KEY (id),
  CONSTRAINT utilisateurs_auth_id_auth_user_fkey FOREIGN KEY (id_auth_user) REFERENCES auth.users(id),
  CONSTRAINT utilisateurs_auth_id_utilisateur_fkey FOREIGN KEY (id_utilisateur) REFERENCES public.utilisateurs(id),
  CONSTRAINT utilisateurs_auth_id_organisation_fkey FOREIGN KEY (id_organisation) REFERENCES public.organisations(id)
);